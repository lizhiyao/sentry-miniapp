# 微信小程序示例

这是一个使用 sentry-miniapp SDK 的微信小程序示例项目。

## 功能特性

- ✅ 错误自动捕获
- ✅ 网络请求监控
- ✅ 用户行为追踪
- ✅ 性能监控
- ✅ 自定义事件上报
- ✅ npm 包下载统计展示

## 使用方法

1. 在微信开发者工具中打开此项目
2. 点击页面中的测试按钮体验各种功能
3. 在 Sentry 后台查看上报的数据
4. 查看首页的 npm 包使用统计数据

## 测试功能

- **网络请求测试**: 测试 HTTP 请求的监控和错误捕获
- **异常捕获测试**: 测试 JavaScript 异常的自动捕获
- **消息上报测试**: 测试自定义事件和消息的上报
- **异步错误测试**: 测试异步代码中的错误捕获
- **统计数据展示**: 实时显示 sentry-miniapp npm 包的下载统计

## 新增功能

### 📊 使用统计

首页新增了统计数据展示区域，实时显示：
- 📦 总下载量（过去一年）
- 📅 本周下载量
- 🔥 今日下载量
- 📈 当前版本号

统计数据通过 npm registry API 获取，展示了 sentry-miniapp 包的使用情况。

## 配置说明

项目已经预配置了 Sentry SDK，你可以在 `app.js` 中修改 Sentry 的配置参数。

### 网络请求配置

为了获取 npm 统计数据，项目配置中已关闭 URL 检查（`urlCheck: false`），允许访问外部 API。

## 预览效果

在微信开发者工具中打开项目后，你将看到：
1. 现代化的渐变背景设计
2. 用户信息卡片
3. **新增**: npm 包使用统计数据展示
4. 功能测试按钮网格
5. 使用指南步骤说明

## 开发模式运行步骤

### 1. 构建 Sentry SDK

在项目根目录运行以下命令，将 TypeScript 源码编译为小程序可用的 JavaScript：

```bash
# 构建小程序版本的 SDK
npm run build:miniapp

# 或者使用开发模式（包含提示信息）
npm run dev:miniapp
```

### 2. 在微信开发者工具中运行

1. 使用微信开发者工具打开此目录（`examples/wxapp`）
2. 在微信开发者工具中导入项目
3. 设置 AppID（可以使用测试号）
4. 点击编译运行

### 3. 开发调试

- 修改源码后，重新运行 `npm run build:miniapp` 重新构建
- 在微信开发者工具中刷新或重新编译即可看到更新

## 功能演示

- **用户信息获取**：演示如何获取用户信息并设置到 Sentry
- **网络请求测试**：演示网络请求的错误捕获
- **异常捕获**：演示手动捕获和上报异常
- **消息上报**：演示自定义消息的上报
- **异步错误**：演示异步错误的捕获

## 注意事项

### 开发模式

- 此示例直接引用源码，用于开发调试
- 每次修改源码后需要重新构建：`npm run build:miniapp`
- 构建后的文件位于 `lib/` 目录下

### 生产使用

在生产环境中使用时，建议：

1. 使用发布的 npm 包而不是直接引用源码
2. 配置真实的 Sentry DSN
3. 根据实际需求调整集成配置
4. 启用生产模式的错误上报

## 文件结构

```
wxapp/
├── app.js          # 应用入口文件
├── app.json        # 应用配置文件
├── app.wxss        # 全局样式文件
├── sitemap.json    # 站点地图配置
├── project.config.json  # 项目配置文件
└── pages/
    └── index/
        ├── index.js    # 首页逻辑
        ├── index.wxml  # 首页结构
        └── index.wxss  # 首页样式
```